<!DOCTYPE html>
<html lang="it">

<head>
    <!-- Essential Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flip 7</title>
    <meta name="description" content="Play Flip 7 card game online with friends">

    <!-- PWA & Mobile Optimization -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="assets/Favicon.webp">
    <link rel="apple-touch-icon" href="assets/Favicon.webp">
    <meta name="apple-mobile-web-app-title" content="Flip 7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1625">

    <!-- Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700;800;900&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <header class="header">
        <button id="btnMenu" class="btn-icon" aria-label="Menu" onclick="toggleLeftSidebar()">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>
        <!-- Game Status in Header (hidden by default, shown during game) -->
        <div id="headerGameStatus"
            style="display:none; align-items:center; gap:12px; background:rgba(139,92,246,0.2); padding:4px 12px; border-radius:20px; backdrop-filter:blur(10px); border:1px solid rgba(139,92,246,0.3);">
            <span style="font-size:12px; font-weight:600; color:#34d399;"><span data-emoji="hourglass not done"
                    style="display:inline-block; animation:spin 3s linear infinite;">‚è≥</span> <span
                    id="turnName">-</span></span><span style="font-size:12px; font-weight:600; color:#60a5fa;">Round
                <span id="roundNum">1</span></span>
        </div>
    </header>

    <!-- LEFT SIDEBAR -->
    <div id="leftSidebarDisplay"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; z-index:9000;">
        <div class="sidebar-backdrop" onclick="toggleLeftSidebar()"
            style="position:absolute; inset:0; background:rgba(0,0,0,0.5); backdrop-filter:blur(5px);"></div>
        <div class="sidebar-content glass"
            style="position:absolute; top:0; left:0; height:100%; width:85vw; max-width:320px; padding:20px; display:flex; flex-direction:column; gap:15px; animation: slideRight 0.3s cubic-bezier(0.16, 1, 0.3, 1); border-radius:0 24px 24px 0; border-left:none; overflow-y:auto;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div
                    style="font-size:28px; font-weight:800; background:linear-gradient(135deg, var(--primary-light), var(--text-gold)); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;">
                    Flip 7</div>
                <div class="close-sidebar" onclick="toggleLeftSidebar()"
                    style="font-size:24px; color:var(--text-muted); cursor:pointer;">&times;</div>
            </div>

            <!-- 1. AUDIO TOGGLE -->
            <div class="menu-item-row"
                style="background:rgba(255,255,255,0.05); padding:12px; border-radius:12px; display:flex; justify-content:space-between; align-items:center;">
                <span class="menu-label">üîä Audio</span>
                <label class="switch-generic">
                    <input type="checkbox" id="audioToggle" checked onchange="toggleAudio(this.checked)">
                    <span class="slider-generic round"></span>
                </label>
            </div>

            <!-- 2. THEME SELECT -->
            <div class="menu-item-row"
                style="background:rgba(255,255,255,0.05); padding:12px; border-radius:12px; display:flex; justify-content:space-between; align-items:center; cursor:pointer; transition:background 0.2s;"
                onclick="openThemeModal()" onmouseenter="this.style.background='rgba(255,255,255,0.1)'"
                onmouseleave="this.style.background='rgba(255,255,255,0.05)'">
                <span class="menu-label">üé® Tema Tavolo</span>
                <div style="display:flex; align-items:center; gap:10px;">
                    <span style="font-size:12px; opacity:0.6;">Modifica</span>
                    <span style="opacity:0.6;">‚ùØ</span>
                </div>
            </div>

            <!-- 3. CARD BACK SELECT -->
            <div class="menu-item-row"
                style="background:rgba(255,255,255,0.05); padding:12px; border-radius:12px; display:flex; justify-content:space-between; align-items:center; cursor:pointer; transition:background 0.2s;"
                onclick="openCardBackModal()" onmouseenter="this.style.background='rgba(255,255,255,0.1)'"
                onmouseleave="this.style.background='rgba(255,255,255,0.05)'">
                <span class="menu-label"><span data-emoji="flower playing cards">üé¥</span> Dorso Carte</span>
                <div style="display:flex; align-items:center; gap:10px;">
                    <span style="font-size:12px; opacity:0.6;">Scegli</span>
                    <span style="opacity:0.6;">‚ùØ</span>
                </div>
            </div>

            <div style="height:1px; background:rgba(255,255,255,0.1); margin:5px 0;"></div>

            <!-- 4. ROOM CODE -->
            <div id="menuRoomCodeArea"
                style="display:none; padding:12px; background:rgba(251, 191, 36, 0.1); border-radius:12px; border:1px solid rgba(251, 191, 36, 0.3);">
                <div
                    style="font-size:10px; text-transform:uppercase; color:var(--text-gold); letter-spacing:1px; margin-bottom:5px; font-weight:bold;">
                    Codice Stanza</div>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <span id="menuTypeRoomCode"
                        style="font-family:monospace; font-size:20px; font-weight:bold; letter-spacing:2px; color:var(--text-bright);">-</span>
                    <button class="btn-icon-small" onclick="copyRoomLink()" style="color:var(--text-gold);"><svg
                            width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg></button>
                </div>
            </div>

            <!-- 9. SHARE BUTTONS -->
            <div id="menuShareArea" style="display:none; gap:10px;">
                <button onclick="shareRoom('whatsapp')"
                    style="flex:1; background:#25D366; border:none; border-radius:8px; padding:10px; color:white; font-weight:bold; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:5px;">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg"
                        style="height:20px; filter:brightness(10);"> WhatsApp
                </button>
                <button onclick="shareRoom('telegram')"
                    style="flex:1; background:#0088cc; border:none; border-radius:8px; padding:10px; color:white; font-weight:bold; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:5px;">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg"
                        style="height:20px;"> Telegram
                </button>
            </div>

            <button class="btn-menu-item" onclick="toggleLeftSidebar(); qs('#rulesModal').classList.add('active');">
                <span style="font-size:20px;" data-emoji="scroll">üìú</span> Regole
            </button>

            <!-- 8. TUTORIAL RAPIDO -->
            <button class="btn-menu-item" onclick="openTutorial()">
                <span style="font-size:20px;" data-emoji="graduation cap">üéì</span> Tutorial Rapido
            </button>

            <div style="height:1px; background:rgba(255,255,255,0.1); margin:5px 0;"></div>

            <!-- 5. BUG REPORT -->
            <a href="mailto:simonepepemail@gmail.com?subject=Flip7 Bug Report" class="btn-menu-link">
                <span data-emoji="lady beetle">üêû</span> Segnala Bug
            </a>

            <!-- 6. SUPPORT -->
            <a href="https://www.paypal.me/peps2k" target="_blank" class="btn-menu-link"
                style="color:var(--text-gold);">
                <span data-emoji="hot beverage">‚òï</span> Offrimi un caff√®
            </a>

            <button class="btn-menu-link" onclick="toggleLeftSidebar(); qs('#creditsModal').classList.add('active')">
                <span data-emoji="information">‚ÑπÔ∏è</span> Crediti
            </button>

            <button id="menuExitBtn" class="btn-menu-link"
                onclick="toggleLeftSidebar(); qs('#exitModal').classList.add('active');"
                style="display:none; color:#EF4444; margin-top:10px;">
                <span data-emoji="door">üö™</span> Esci
            </button>

            <div style="margin-top:auto; font-size:11px; color:rgba(255,255,255,0.3); text-align:center;">
                v1.2.0 ‚Ä¢ Simone Pepe
            </div>
        </div>
    </div>
    <div class="lobby glass" id="lobby"><img src="assets/Flip7 Logo.webp" alt="Flip 7"
            style="height:80px; margin-bottom:15px; cursor:pointer;"
            onclick="window.location.href = window.location.origin + window.location.pathname">
        <h2>Benvenuto !</h2>
        <p>Sfida i tuoi amici ! Il primo che arriva a 200 punti,
            vince ! üèÜ</p><input type="text" id="nickname" placeholder="Il tuo nickname" maxlength="15">
        <div id="hostControls"><button class="btn" id="btnCreateRoom">Crea Stanza</button><button
                class="btn btn-secondary" id="btnShowJoin" style="margin-top:10px;">Unisciti</button>
            <div id="joinCodeArea"
                style="display:none; margin-top:15px; border-top:1px solid rgba(255,255,255,0.1); padding-top:15px; width:100%">
                <input type="text" id="roomCodeInput" placeholder="Inserisci codice stanza..." maxlength="10"
                    style="margin-bottom:10px; text-transform:uppercase; text-align:center; letter-spacing:1px;"><button
                    class="btn btn-secondary" id="btnJoinRoom" style="width:100%">Unisciti</button>
            </div>
        </div>
        <div id="roomInfo" style="display:none;">
            <div class="room-link">
                <div id="qrcode-container">
                    <div id="qrcode"></div><span style="font-size:12px; color:var(--text-secondary)">Scansiona per
                        unirti</span>
                </div><button class="btn btn-secondary" style="margin-top:10px; padding:8px 16px; font-size:12px;"
                    onclick="copyRoomLink()">üìã Copia Link</button>
            </div>
            <!-- MEME MODE SWITCH (Centered) -->
            <div id="memeSwitchContainer"
                style="margin: 15px 0 20px 0; display: flex; justify-content: center; align-items: center; gap: 12px; background: rgba(255,255,255,0.05); padding: 12px 20px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease;">
                <!-- Theme Toggle -->
                <!-- Theme Toggle REMOVED -->
                <span style="font-size: 22px;">üé≠</span>
                <label class="switch" style="position: relative; display: inline-block; width: 50px; height: 28px;">
                    <input type="checkbox" id="memeCheckbox" onchange="window.toggleMemeMode()">
                    <span class="slider round"
                        style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; transition: .4s; border-radius: 34px;"></span>
                </label>
                <div style="text-align: left;">
                    <div style="font-weight: 700; font-size: 14px; color: #fff;">Meme Mode</div>
                    <div style="font-size: 10px; color: rgba(255,255,255,0.5);">Suoni e splash divertenti</div>
                </div>
            </div>
            <div class="players-list" id="playersList"></div>
            <p id="lobbyStatusMsg" style="font-size:12px; color:var(--text-secondary); margin-top:10px">In attesa che
                l'host avvii la partita...</p>
            <button class="btn btn-secondary" id="btnAddBot" style="display:none; margin-bottom:10px;" onclick="addBot()">ü§ñ Aggiungi Bot</button>
            <button class="btn" id="btnStartGame" style="display:none; align-items:center; gap:8px;">
                <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Alien%20Monster.png" style="width:28px; height:28px; vertical-align:middle;">
                Inizia Partita
            </button>
        </div>
    </div>
    <div class="game-container" id="gameContainer">
        <!-- Left Sidebar: Leaderboard -->
        <div id="leaderboardSidebar" class="sidebar left glass">
            <div class="sidebar-tab left glass" onclick="toggleSidebar('leaderboardSidebar')">üèÜ </div>
            <div class="sidebar-content">
                <h3>üèÜ Classifica</h3><span
                    style="font-size:12px; color:var(--text-secondary); margin-bottom:15px">Obiettivo: 200
                    pts</span>
                <div id="sidebarLeaderboardContent"></div><button class="btn btn-3d btn-stats" id="btnStats" disabled
                    aria-label="Statistiche"
                    style="width:60%; margin-top:20px; display:flex; align-items:center; justify-content:center; gap:10px; padding:12px; justify-self: center;"><span
                        style="font-size:20px;">üìä</span><span
                        style="font-size:14px; font-weight:600;">Statistiche</span></button>
            </div>
        </div>
        <!-- Right Sidebar: History -->
        <div id="historySidebar" class="sidebar right glass">
            <div class="sidebar-tab right glass" onclick="toggleSidebar('historySidebar')">üìú </div>
            <div class="sidebar-content">
                <h3>üìú Storico</h3><span
                    style="font-size:12px; color:var(--text-secondary); margin-bottom:15px">Cronologia
                    partite</span>
                <div id="sidebarHistoryContent" class="history-list">
                    <div style="text-align:center; padding:20px; color:var(--text-secondary); font-style:italic">
                        Nessuna azione ancora...</div>
                </div>
            </div>
        </div>
        <div class="deck-area"
            style="display:flex; align-items:center; justify-content:center; gap:15px; margin:20px 0;">
            <!-- Personal Score -->
            <div class="glass" style="padding:10px 16px; border-radius:16px; text-align:center; min-width: 70px;">
                <div
                    style="font-size:9px; opacity:0.7; text-transform:uppercase; letter-spacing:1px; margin-bottom:2px;">
                    Punti</div>
                <div style="font-size:22px; font-weight:800; color:#A78BFA; text-shadow:0 0 15px rgba(167, 139, 250, 0.4);"
                    id="personalTot">0</div>
            </div>
            <!-- Deck with layered cards -->
            <div class="deck" id="deckContainer"
                style="width:90px; height:126px; position:relative; transform-style:preserve-3d; transition:all 0.3s; cursor:default;">
                <!-- Layered cards for depth effect -->
                <div id="deckLayers" style="position:absolute; inset:0;">
                    <div class="deck-layer"
                        style="position:absolute; top:0; left:0; width:100%; height:100%; transform:translateX(-4px) translateY(4px) rotate(-1deg);">
                        <img src="assets/cards/back.webp" class="deck-back-img"
                            style="width:100%; height:100%; border-radius:12px; object-fit:cover; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">
                    </div>
                    <div class="deck-layer"
                        style="position:absolute; top:0; left:0; width:100%; height:100%; transform:translateX(-2px) translateY(2px) rotate(-0.5deg);">
                        <img src="assets/cards/back.webp" class="deck-back-img"
                            style="width:100%; height:100%; border-radius:12px; object-fit:cover; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">
                    </div>
                    <div class="deck-layer"
                        style="position:absolute; top:0; left:0; width:100%; height:100%; transform:translateX(0) translateY(0) rotate(0deg);">
                        <img src="assets/cards/back.webp" class="deck-back-img"
                            style="width:100%; height:100%; border-radius:12px; object-fit:cover; box-shadow: 0 4px 15px rgba(0,0,0,0.4);">
                    </div>
                </div>
            </div>
            <!-- Deck Count (right of deck) -->
            <div class="glass" style="padding:10px 16px; border-radius:16px; text-align:center; min-width: 70px;">
                <div
                    style="font-size:9px; opacity:0.7; text-transform:uppercase; letter-spacing:1px; margin-bottom:2px;">
                    Carte</div>
                <div style="font-size:22px; font-weight:800; color:var(--text-gold); text-shadow:0 0 15px rgba(251, 191, 36, 0.4);"
                    id="deckCount">0</div>
            </div>
        </div>
        <!-- Dynamic Zone: Active Player (shows current turn player if not me) -->
        <div id="activePlayerZone" class="active-player-zone glass"></div>
        <!-- Dynamic Zone: Action Target (shows during Freeze/Flip3 dual display) -->
        <div id="actionTargetZone" class="action-target-zone glass" style="display:none;"></div>
        <!-- Other players (excluding me and those shown above) -->
        <div class="players-area" id="playersArea"></div>
        <!-- Controls with MY HAND always visible -->
        <div class="controls glass" id="controls" role="group" aria-label="Azioni gioco">
            <!-- My Hand Zone (always visible at bottom) -->
            <div id="myHandZone" class="my-hand-zone"></div>
            <!-- Buttons Row -->
            <div class="buttons-row"><button class="btn btn-3d btn-carta" id="btnHit" disabled
                    aria-label="Pesca una carta" style="flex:2;"><img
                        src="https://em-content.zobj.net/source/microsoft-teams/400/palm-up-hand_medium-light-skin-tone_1faf4-1f3fc_1f3fc.png"
                        alt="Carta" style="height:40px; width:auto; pointer-events:none;"></button>
                <div style="flex:1; position:relative; display:flex; align-items:center; justify-content:center;">
                    <button class="btn btn-3d btn-react" id="btnReact" aria-label="Reazioni" disabled
                        style="width:100%; height:100%; z-index:9999; padding:0; display:flex; align-items:center; justify-content:center; background:transparent; border:none; box-shadow:none; cursor:pointer; border-radius:50%;"><img
                            src="https://em-content.zobj.net/source/microsoft-teams/400/speech-balloon_1f4ac.png"
                            style="height:35px; filter:drop-shadow(0 4px 6px rgba(0,0,0,0.2)); transition:transform 0.2s;"></button>
                    <div id="reactionPicker" class="glass" style="display: none;
                                                        position: fixed;
                                                        bottom: 100px;
                                                        left: 50%;
                                                        transform: translateX(-50%);
                                                        width: 90%;
                                                        max-width: 400px;
                                                        max-height: 250px;
                                                        overflow-y: auto;
                                                        padding: 15px;
                                                        display: grid;
                                                        grid-template-columns: repeat(6, 1fr);
                                                        gap: 10px;
                                                        z-index: 10000 !important;
                                                        opacity: 0;
                                                        transition: opacity 0.2s;
                                                        box-shadow: 0 15px 50px rgba(0,0,0,0.8);
                                                        border: 1px solid rgba(255,255,255,0.2);
                                                        ">
                        <style>
                            .floating-reaction {
                                z-index: 10000 !important;
                            }
                        </style>
                        <!-- Filled by JS -->
                    </div>
                </div><button class="btn btn-3d btn-stop" id="btnStay" disabled aria-label="Fermati" style="flex:2;">
                    <!-- FIX 6: Using Raising Hands APNG for Stay button --><img
                        src="https://raw.githubusercontent.com/sjmvne/Animated-Fluent-Emojis/master/Emojis/Hand%20gestures/Raising%20Hands%20Medium-Light%20Skin%20Tone.png"
                        alt="Stop" style="height:40px; width:auto; pointer-events:none;">
                </button>
            </div>
        </div>
    </div>
    <!-- Stats Bottom Sheet -->
    <div id="statsSheet">
        <div class="stats-handle"></div>
        <div class="stats-header">
            <h3>üìä Statistiche Partita</h3><button class="stats-close" onclick="closeStatsSheet()">&times;
            </button>
        </div>
        <div class="stats-content">
            <div class="stats-grid">
                <div class="chart-card full-width">
                    <h4>üìà Punteggio Cumulativo</h4><canvas id="chartLine"></canvas>
                </div>
                <div class="chart-card">
                    <h4>üìä Azioni per Giocatore</h4><canvas id="chartBar"></canvas>
                </div>
                <div class="chart-card">
                    <h4>üéØ Distribuzione Azioni</h4><canvas id="chartDonut"></canvas>
                </div>
                <div class="chart-card">
                    <h4>üî• Carte vs Outcome</h4><canvas id="chartHeatmap"></canvas>
                </div>
                <div class="chart-card">
                    <h4>‚≠ê Performance Giocatori</h4><canvas id="chartRadar"></canvas>
                </div>
            </div>
        </div>
    </div>
    <!-- TARGET MODAL (Premium) -->
    <div class="modal" id="targetModal">
        <div class="modal-content-premium" style="max-width: 400px;">
            <div class="modal-header-premium" style="padding-bottom:15px;">
                <div style="font-size:60px; margin-bottom:10px;">üéØ</div>
                <h2 id="modalTitle" class="premium-title" style="font-size:20px;">Scegli Bersaglio</h2>
                <div style="font-size:12px; opacity:0.6;">Seleziona un giocatore per l'azione</div>
            </div>
            <div class="modal-body-premium" id="targetButtons" style="padding:20px; max-height:50vh;">
                <!-- Targets injected by JS -->
            </div>

        </div>
    </div>

    <!-- CARD BACK MODAL (Infinite Carousel) -->
    <div class="modal" id="cardBackModal">
        <div class="modal-content-premium" style="max-width: 400px;">
            <div class="modal-header-premium">
                <div style="font-size:60px; margin-bottom:10px;">üé®</div>
                <h2 class="premium-title">Scegli Dorso</h2>
            </div>

            <div class="modal-body-premium" style="align-items:center; overflow:visible;">
                <!-- Carousel Container -->
                <div
                    style="display:flex; align-items:center; justify-content:space-between; width:100%; margin:10px 0;">
                    <button class="carousel-btn" onclick="prevBack()">‚ùÆ</button>

                    <div style="position:relative; width:140px; height:196px; perspective:1000px;">
                        <img id="cbImage" src="assets/cards/back.webp"
                            style="width:100%; height:100%; object-fit:contain; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.5); filter:drop-shadow(0 0 10px rgba(167, 139, 250, 0.4)); animation: cardFloat 3s ease-in-out infinite;">
                    </div>

                    <button class="carousel-btn" onclick="nextBack()">‚ùØ</button>
                </div>

                <div style="text-align:center;">
                    <h3 id="cbName" style="color:#fbbf24; font-size:22px; margin-bottom:5px;">Classico</h3>
                    <p id="cbDesc" style="color:rgba(255,255,255,0.7); font-size:14px; min-height:40px;">Il dorso
                        originale.</p>
                    <div id="cbCounter" style="font-size:12px; opacity:0.5; margin-top:5px;">1 / 12</div>
                </div>
            </div>

            <div
                style="padding:20px; text-align:center; border-top:1px solid rgba(255,255,255,0.05); display:flex; gap:10px;">
                <button class="btn btn-secondary"
                    onclick="document.getElementById('cardBackModal').classList.remove('active')"
                    style="flex:1;">Annulla</button>
                <button class="btn" onclick="selectCurrentBack()" style="flex:2;">Seleziona</button>
            </div>
        </div>
    </div>

    <!-- THEME MODAL -->
    <div class="modal" id="themeModal">
        <div class="modal-content-premium" style="max-width: 400px;">
            <div class="modal-header-premium">
                <div style="font-size:60px; margin-bottom:10px;">üé®</div>
                <h2 class="premium-title">Scegli Tema</h2>
            </div>
            <div class="modal-body-premium" id="themeList">
                <!-- Themes Injected JS -->
            </div>
            <div style="padding:15px; text-align:center;">
                <button class="btn btn-secondary"
                    onclick="document.getElementById('themeModal').classList.remove('active')"
                    style="width:100%;">Chiudi</button>
            </div>
        </div>
    </div>


    <!-- RULES MODAL -->
    <div class="modal" id="rulesModal">
        <div class="modal-content-premium" style="max-width: 500px; height: 750px; max-height: 90vh;">
            <div class="modal-header-premium">
                <div style="font-size:40px; margin-bottom:10px;">üìñ</div>
                <h2 class="premium-title">Regolamento Ufficiale</h2>
                <div style="font-size: 14px; opacity: 0.7; font-weight: normal;">Flip 7</div>
            </div>

            <!-- Sticky Tabs -->
            <div class="rules-tabs"
                style="display:flex; gap:10px; padding:10px 20px; background:rgba(0,0,0,0.2); border-bottom:1px solid rgba(255,255,255,0.1); overflow-x: auto; flex-shrink: 0;">
                <button class="tab-btn active" onclick="switchRulesTab('gen')">Generale</button>
                <button class="tab-btn" onclick="switchRulesTab('cards')">Carte</button>
                <button class="tab-btn" onclick="switchRulesTab('actions')">Azioni</button>
                <button class="tab-btn" onclick="switchRulesTab('score')">Punti</button>
            </div>

            <div class="modal-body-premium" id="rulesBody"
                style="flex: 1; overflow-y: auto; padding: 20px; position:relative;">

                <!-- TAB: GENERALE -->
                <div id="tab-gen" class="rules-section active">
                    <p style="font-size:15px; line-height:1.6; opacity:0.9; margin-bottom:20px;">
                        <strong>Flip 7</strong> √® un gioco di rischio e fortuna. L'obiettivo √® accumulare punti sommando
                        le carte, ma... attenzione a non sballare!
                    </p>

                    <div class="premium-card"
                        style="margin-bottom:15px; border-color: #ef4444; background: rgba(239, 68, 68, 0.1);">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                            <span style="font-size:24px;" data-emoji="bomb">üí£</span>
                            <strong style="color: #fca5a5; font-size:16px;">BUST (Sballare)</strong>
                        </div>
                        <p style="font-size:13px; opacity:0.9; margin:0; line-height:1.5;">
                            Se peschi una carta numero che <strong>√® gi√† presente</strong> nella tua mano corrente,
                            sballi immediatamente.
                            <br>Perdi tutti i punti del round! üò°
                        </p>
                    </div>

                    <div class="premium-card"
                        style="margin-bottom:15px; border-color: #a855f7; background: rgba(168, 85, 247, 0.1);">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                            <span style="font-size:24px;" data-emoji="trophy">üèÜ</span>
                            <strong style="color: #d8b4fe; font-size:16px;">FLIP 7 BONUS (+15)</strong>
                        </div>
                        <p style="font-size:13px; opacity:0.9; margin:0; line-height:1.5;">
                            Raccogli <strong>7 carte uniche</strong> (tra numeri, azioni e modificatori) per vincere
                            SUBITO il round con un bonus di 15 punti!
                        </p>
                    </div>
                </div>

                <!-- TAB: CARTE -->
                <div id="tab-cards" class="rules-section" style="display:none;">
                    <h3 style="font-size:16px; color:#fbbf24; margin-bottom:10px;">Carte Numero (0-12)</h3>
                    <p style="font-size:13px; opacity:0.8; margin-bottom:15px;">La quantit√† di carte nel mazzo √® uguale
                        al loro valore.</p>

                    <div style="display:flex; gap:10px; margin-bottom:20px; justify-content:center;">
                        <div style="text-align:center;">
                            <img src="assets/cards/number_1.webp"
                                style="height:70px; border-radius:6px; box-shadow:0 4px 8px rgba(0,0,0,0.3);">
                            <div style="font-size:10px; margin-top:4px; opacity:0.6;">1 Copia</div>
                        </div>
                        <div style="text-align:center;">
                            <img src="assets/cards/number_7.webp"
                                style="height:70px; border-radius:6px; box-shadow:0 4px 8px rgba(0,0,0,0.3);">
                            <div style="font-size:10px; margin-top:4px; opacity:0.6;">7 Copie</div>
                        </div>
                        <div style="text-align:center;">
                            <img src="assets/cards/number_12.webp"
                                style="height:70px; border-radius:6px; box-shadow:0 4px 8px rgba(0,0,0,0.3);">
                            <div style="font-size:10px; margin-top:4px; opacity:0.6;">12 Copie</div>
                        </div>
                    </div>

                    <h3 style="font-size:16px; color:#60a5fa; margin-bottom:10px;">Modificatori</h3>
                    <div class="premium-card" style="margin-bottom:10px;">
                        <div style="display:flex; gap:15px; align-items:center;">
                            <img src="assets/cards/modifier_+10.webp" style="height:50px; border-radius:4px;">
                            <div>
                                <strong style="color:#60a5fa; font-size:14px;">Punti Extra (+N)</strong>
                                <p style="font-size:12px; opacity:0.7; margin:0;">Aggiungono valore al totale.
                                    <br><strong>NON vengono moltiplicati dal x2.</strong>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="premium-card">
                        <div style="display:flex; gap:15px; align-items:center;">
                            <img src="assets/cards/modifier_x2.webp" style="height:50px; border-radius:4px;">
                            <div>
                                <strong style="color:#60a5fa; font-size:14px;">Moltiplicatore (x2)</strong>
                                <p style="font-size:12px; opacity:0.7; margin:0;">Raddoppia SOLO la somma delle carte
                                    numero.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: AZIONI -->
                <div id="tab-actions" class="rules-section" style="display:none;">
                    <p style="font-size:13px; opacity:0.8; margin-bottom:15px;">Le carte azione non danno punti, ma
                        cambiano le sorti della partita.</p>

                    <div class="premium-card" style="margin-bottom:15px; border-left: 3px solid #38bdf8;">
                        <div style="display:flex; gap:15px;">
                            <img src="assets/cards/action_freeze.webp" style="height:60px; border-radius:4px;">
                            <div>
                                <strong style="color:#38bdf8; font-size:15px;">Freeze</strong>
                                <p style="font-size:12px; opacity:0.8; margin-top:4px; line-height:1.4;">
                                    Scegli un avversario. Sar√† costretto a <strong>FERMARSI (STAY)</strong>
                                    immediatamente!
                                    <br>Il suo round finisce qui. ‚ùÑÔ∏è
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="premium-card" style="margin-bottom:15px; border-left: 3px solid #fbbf24;">
                        <div style="display:flex; gap:15px;">
                            <img src="assets/cards/action_flip3.webp" style="height:60px; border-radius:4px;">
                            <div>
                                <strong style="color:#fbbf24; font-size:15px;">Flip 3</strong>
                                <p style="font-size:12px; opacity:0.8; margin-top:4px; line-height:1.4;">
                                    Scegli un avversario. Dovr√† pescare <strong>3 carte</strong> consecutive! Se
                                    sopravvive, tiene i punti.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="premium-card" style="margin-bottom:15px; border-left: 3px solid #f43f5e;">
                        <div style="display:flex; gap:15px;">
                            <img src="assets/cards/action_second_chance.webp" style="height:60px; border-radius:4px;">
                            <div>
                                <strong style="color:#f43f5e; font-size:15px;">Second Chance</strong>
                                <p style="font-size:12px; opacity:0.8; margin-top:4px; line-height:1.4;">
                                    Protezione passiva. Se sballi, questa carta si brucia per salvarti e scartare il
                                    doppione.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: PUNTI -->
                <div id="tab-score" class="rules-section" style="display:none;">
                    <h3 style="font-size:16px; margin-bottom:15px; color:#fff;">Calcolo Punteggio</h3>

                    <div class="premium-card" style="margin-bottom:20px;">
                        <div
                            style="font-size:16px; font-weight:bold; margin-bottom:10px; text-align:center; color:#a78bfa;">
                            Formula Ufficiale</div>
                        <div
                            style="background:rgba(0,0,0,0.3); padding:10px; border-radius:8px; text-align:center; font-family:monospace; font-size:14px; margin-bottom:10px;">
                            (Somma Numeri * x2) + Modificatori
                        </div>
                        <div style="font-size:12px; opacity:0.8; text-align:center;">
                            * Il Bonus Flip 7 (+15) si aggiunge alla fine.
                        </div>
                    </div>

                    <div class="premium-card">
                        <strong style="display:block; margin-bottom:10px; font-size:14px; color:#22c55e;">Esempio
                            Pratico</strong>
                        <ul
                            style="font-size:13px; opacity:0.8; list-style-type:none; padding:0; margin:0; line-height:1.8;">
                            <li>üÉè Carte Numero: <strong>5, 10, 2</strong> (Somma: 17)</li>
                            <li>‚úñÔ∏è Moltiplicatore: <strong>x2</strong> (17 * 2 = 34)</li>
                            <li>‚ûï Modificatore: <strong>+4</strong> (34 + 4 = 38)</li>
                            <li style="margin-top:10px; border-top:1px solid rgba(255,255,255,0.1); padding-top:5px;">
                                Totale Round: <strong style="color:var(--text-gold); font-size:15px;">38 Punti</strong>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="modal-footer-premium">
                <button class="btn btn-primary" onclick="closeModal('rulesModal')">Ho Capito!</button>
            </div>
        </div>
    </div>
    </div>



    <div id="endGameOverlay"
        style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.95); z-index:2000; align-items:center; justify-content:center; flex-direction:column; backdrop-filter:blur(20px); overflow-y:auto; padding:20px;">
        <div id="endGameStatus" style="text-align:center; margin-bottom:20px;"></div>
        <div id="endGameLeaderboard"
            style="width:100%; max-width:400px; background:rgba(255,255,255,0.08); border-radius:16px; padding:20px; border:1px solid rgba(255,255,255,0.1);">
        </div>
        <div id="endgameStatsContainer" class="endgame-stats"
            style="width:100%; max-width:500px; max-height:300px; overflow-y:auto;"></div>
        <button class="btn" id="btnRestartGame" onclick="restartGame()" style="margin-top:25px;">üîÑ Nuova
            Partita</button>
    </div>
    <div id="customToast"></div>
    <div id="recapOverlay"></div>
    <div id="cardSplash"></div>
    <div id="flip7Overlay"
        style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.85); z-index:2500; align-items:center; justify-content:center; flex-direction:column; backdrop-filter:blur(20px);">
        <!-- FIX 5: Using official Flip7 Logo instead of emoji -->
        <img src="assets/Flip7 Logo.webp" alt="Flip7"
            style="height:120px; animation: bounce 0.5s ease infinite alternate, pulseGlow 1s ease infinite; filter: drop-shadow(0 0 30px rgba(251, 191, 36, 0.8));">
        <h1
            style="font-size:56px; margin:20px 0; background:linear-gradient(135deg, #fbbf24, #f59e0b, #eab308); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; animation: pulseGlow 0.5s ease infinite alternate;">
            FLIP 7!</h1>
        <p class="flip7-winner-name" style="font-size:28px; color:white; margin-bottom:10px; font-weight:700;"></p>
        <p style="font-size:18px; color:rgba(255,255,255,0.7);">+15 Punti Bonus! üéâ</p>
    </div>
    <!-- PWA Install Banner -->
    <div id="installBanner" class="install-banner">
        <div class="close-install" onclick="document.getElementById('installBanner').classList.remove('visible');">‚úï
        </div>
        <img src="assets/Flip7%20Logo.webp" class="install-img" alt="Flip 7 Icon">
        <div class="install-text">
            <strong>Installa Flip 7</strong>
            Esperienza schermo intero! üöÄ
        </div>
        <button class="install-btn" onclick="installApp()">Installa</button>
    </div>

    <!-- iOS Install Guide Modal -->
    <div id="iosPwaModal" onclick="this.classList.remove('active')">
        <div class="ios-pwa-content" onclick="event.stopPropagation()">
            <div style="font-size: 50px; margin-bottom: 20px;">üì±</div>
            <h2 style="color:white; margin-bottom: 15px;">Installa Flip 7 su iOS</h2>
            <p style="color:rgba(255,255,255,0.7); line-height: 1.6; margin-bottom: 30px;">
                Per un'esperienza di gioco senza distrazioni e a schermo intero:
            </p>

            <div
                style="text-align: left; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 30px;">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <div
                        style="background: var(--primary); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; flex-shrink: 0;">
                        1</div>
                    <span style="color: white; font-size: 15px;">Premi il pulsante <strong>Condividi</strong> (<img
                            src="assets/share.png" style="height: 20px; vertical-align: middle;">) nella barra di
                        Safari</span>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div
                        style="background: var(--primary); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; flex-shrink: 0;">
                        2</div>
                    <span style="color: white; font-size: 15px;">Seleziona <strong>Aggiungi alla schermata
                            Home</strong>
                        (<img src="assets/add.png" style="height: 18px; vertical-align: middle;">)</span>
                </div>
            </div>

            <button class="btn" style="width: 100%;"
                onclick="document.getElementById('iosPwaModal').classList.remove('active')">Capito!</button>
        </div>
    </div>
    <!-- TUTORIAL MODAL -->
    <div class="modal" id="tutorialModal">
        <div class="modal-content-premium">
            <!-- Premium Header -->
            <div class="modal-header-premium">
                <div style="font-size:60px; line-height:1; margin-bottom:10px;">üéì</div>
                <h2 class="premium-title"
                    style="background: linear-gradient(to right, #A78BFA, #fbbf24); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                    Tutorial Rapido</h2>
                <div style="font-size:13px; color:rgba(255,255,255,0.5);">Impara a giocare in 30 secondi</div>
            </div>

            <div class="modal-body-premium">
                <!-- Slides Container -->
                <div class="tutorial-slides"
                    style="min-height:300px; display:flex; flex-direction:column; justify-content:center;">
                    <!-- Slide 1: Welcome -->
                    <div class="tut-slide active" id="tut-slide-1">
                        <div style="text-align:center; padding:10px;">
                            <img src="assets/Flip7 Logo.webp" style="height:60px; margin-bottom:15px;">
                            <h3 style="color:#fbbf24; margin-bottom:10px; font-size:22px;">Benvenuto su Flip 7!</h3>
                            <p style="opacity:0.9; line-height:1.5; font-size:14px; margin-bottom:20px;">
                                Flip 7 √® un gioco di rischio e fortuna.<br>
                                L'obiettivo √® ottenere punti sommando le carte, ma...<br>
                                <strong>Attenzione a non sballare (BUST)!</strong>
                            </p>
                            <div class="premium-card" style="text-align:center; padding:15px;">
                                üéØ Vince chi arriva a <strong>200 Punti</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Slide 2: The Deck -->
                    <div class="tut-slide" id="tut-slide-2">
                        <h3 style="color:#60a5fa; text-align:center; margin-bottom:15px;">Il Mazzo</h3>
                        <div class="premium-card" style="margin-bottom:10px;">
                            <div style="display:flex; align-items:center; gap:10px; margin-bottom:5px;">
                                <span class="emoji-target" data-emoji="input numbers" style="font-size:20px;">üî¢</span>
                                <strong>Carte Numero (0-12)</strong>
                            </div>
                            <div style="font-size:13px; opacity:0.8;">Il mazzo contiene una quantit√† di carte uguale al
                                loro valore (dodici 12, due 2, uno 0).</div>
                        </div>
                        <div class="premium-card" style="border-color:#EF4444; background:rgba(239, 68, 68, 0.1);">
                            <div style="display:flex; align-items:center; gap:10px; margin-bottom:5px;">
                                <span class="emoji-target" data-emoji="bomb" style="font-size:20px;">üí£</span>
                                <strong style="color:#fca5a5;">REGOLA D'ORO</strong>
                            </div>
                            <div style="font-size:13px; opacity:0.9;">
                                Se peschi un numero che hai gi√† davanti a te,<br>
                                <strong>SBALLI (0 Punti)</strong> e il tuo turno finisce!
                            </div>
                        </div>
                    </div>

                    <!-- Slide 3: Actions -->
                    <div class="tut-slide" id="tut-slide-3">
                        <h3 style="color:#A78BFA; text-align:center; margin-bottom:15px;">Azioni Speciali</h3>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                            <div class="premium-card" style="text-align:center; padding:10px;">
                                <div class="emoji-target" data-emoji="snowflake" style="font-size:24px;">‚ùÑÔ∏è</div>
                                <div style="font-weight:700; font-size:12px; color:#38bdf8;">Freeze</div>
                                <div style="font-size:10px; opacity:0.7;">Congela un avversario (Stop!)</div>
                            </div>
                            <div class="premium-card" style="text-align:center; padding:10px;">
                                <div class="emoji-target" data-emoji="high voltage" style="font-size:24px;">‚ö°</div>
                                <div style="font-weight:700; font-size:12px; color:#fbbf24;">Flip 3</div>
                                <div style="font-size:10px; opacity:0.7;">Pesca 3 carte extra!</div>
                            </div>
                            <div class="premium-card" style="text-align:center; padding:10px;">
                                <div class="emoji-target" data-emoji="red heart" style="font-size:24px;">‚ù§Ô∏è</div>
                                <div style="font-weight:700; font-size:12px; color:#F43F5E;">2nd Chance</div>
                                <div style="font-size:10px; opacity:0.7;">Salva dal primo BUST</div>
                            </div>
                            <div class="premium-card" style="text-align:center; padding:10px;">
                                <div class="emoji-target" data-emoji="cross mark" style="font-size:24px;">‚úñÔ∏è</div>
                                <div style="font-weight:700; font-size:12px; color:#818cf8;">Bonus</div>
                                <div style="font-size:10px; opacity:0.7;">x2, +10 (solo se non sballi)</div>
                            </div>
                        </div>
                    </div>

                    <!-- Slide 4: Flip 7 -->
                    <div class="tut-slide" id="tut-slide-4">
                        <div style="text-align:center;">
                            <div class="emoji-target" data-emoji="party popper"
                                style="font-size:50px; margin-bottom:10px; animation:bounce 2s infinite;">üéâ</div>
                            <h3
                                style="background:linear-gradient(to right, #22c55e, #4ade80); -webkit-background-clip:text; -webkit-text-fill-color:transparent; font-size:28px; font-weight:800;">
                                FLIP 7!</h3>
                            <p style="margin:20px 0; font-size:15px; line-height:1.6;">
                                Se ottieni esattamente<br>
                                <strong>7 carte numero diverse</strong>...
                            </p>
                            <div class="premium-card" style="background:rgba(34, 197, 94, 0.1); border-color:#22c55e;">
                                ‚úÖ Il round finisce subito<br>
                                ‚úÖ Ottieni <strong>+15 Punti Bonus</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="display:flex; justify-content:center; gap:8px; margin-bottom:15px;" id="tutDots"></div>

            <div
                style="padding:20px; text-align:center; border-top:1px solid rgba(255,255,255,0.05); display:flex; gap:10px;">
                <button class="btn btn-secondary" onclick="prevTutSlide()" id="btnPrevTut"
                    style="flex:1;">Indietro</button>
                <button class="btn" onclick="nextTutSlide()" id="btnNextTut" style="flex:2;">Avanti</button>
            </div>
            <button onclick="qs('#tutorialModal').classList.remove('active')"
                style="position:absolute; top:15px; right:15px; width:30px; height:30px; border-radius:50%; background:rgba(0,0,0,0.3); color:white; border:none; cursor:pointer;">&times;</button>
        </div>
    </div>

    <!-- CREDITS MODAL -->
    <div class="modal" id="creditsModal">
        <div class="modal-content glass"
            style="max-width:400px; padding:0; overflow:hidden; border:1px solid rgba(255,255,255,0.1);">
            <!-- Header -->
            <div
                style="background:linear-gradient(135deg, rgba(167, 139, 250, 0.2), rgba(251, 191, 36, 0.2)); padding:25px; text-align:center; border-bottom:1px solid rgba(255,255,255,0.05);">
                <h2
                    style="margin:0; font-size:28px; background:linear-gradient(to right, #A78BFA, #fbbf24); -webkit-background-clip:text; -webkit-text-fill-color:transparent; filter:drop-shadow(0 0 10px rgba(167,139,250,0.3));">
                    Flip 7</h2>
                <div
                    style="font-size:12px; color:rgba(255,255,255,0.5); letter-spacing:2px; margin-top:5px; text-transform:uppercase;">
                    Web Experience</div>
            </div>

            <!-- Content -->
            <div style="padding:25px; display:flex; flex-direction:column; gap:15px;">

                <!-- Dev Card -->
                <div
                    style="background:rgba(255,255,255,0.03); border-radius:16px; padding:15px; display:flex; align-items:center; gap:15px; border:1px solid rgba(255,255,255,0.05);">
                    <div
                        style="font-size:24px; background:rgba(255,255,255,0.1); width:48px; height:48px; border-radius:12px; display:flex; align-items:center; justify-content:center;">
                        <span data-emoji="technologist">üë®‚Äçüíª</span>
                    </div>
                    <div>
                        <div
                            style="font-size:11px; text-transform:uppercase; color:rgba(255,255,255,0.4); letter-spacing:1px; font-weight:700;">
                            Sviluppo & Design</div>
                        <div style="font-size:16px; font-weight:600; color:white;">Simone Pepe</div>
                    </div>
                </div>

                <!-- Idea Card -->
                <div
                    style="background:rgba(255,255,255,0.03); border-radius:16px; padding:15px; display:flex; align-items:center; gap:15px; border:1px solid rgba(255,255,255,0.05);">
                    <div
                        style="font-size:24px; background:rgba(255,255,255,0.1); width:48px; height:48px; border-radius:12px; display:flex; align-items:center; justify-content:center;">
                        <span data-emoji="light bulb">üí°</span>
                    </div>
                    <div>
                        <div
                            style="font-size:11px; text-transform:uppercase; color:rgba(255,255,255,0.4); letter-spacing:1px; font-weight:700;">
                            Idea Originale</div>
                        <div style="font-size:16px; font-weight:600; color:white;">Eric Olsen</div>
                    </div>
                </div>

                <!-- Resources -->
                <div
                    style="background:rgba(255,255,255,0.03); border-radius:16px; padding:15px; border:1px solid rgba(255,255,255,0.05);">
                    <div
                        style="font-size:11px; text-transform:uppercase; color:rgba(255,255,255,0.4); letter-spacing:1px; font-weight:700; margin-bottom:8px;">
                        Tecnologie & Risorse</div>
                    <div style="display:flex; flex-wrap:wrap; gap:8px;">
                        <span
                            style="background:rgba(247, 223, 30, 0.1); color:#f7df1e; padding:4px 8px; border-radius:6px; font-size:11px; font-weight:600;">JavaScript</span>
                        <span
                            style="background:rgba(227, 76, 38, 0.1); color:#e34c26; padding:4px 8px; border-radius:6px; font-size:11px; font-weight:600;">HTML5</span>
                        <span
                            style="background:rgba(38, 77, 228, 0.1); color:#264de4; padding:4px 8px; border-radius:6px; font-size:11px; font-weight:600;">CSS3</span>
                        <span
                            style="background:rgba(255,255,255,0.1); color:white; padding:4px 8px; border-radius:6px; font-size:11px;">Howler.js</span>
                        <span
                            style="background:rgba(255,255,255,0.1); color:white; padding:4px 8px; border-radius:6px; font-size:11px;">PeerJS</span>
                        <span
                            style="background:rgba(255,255,255,0.1); color:white; padding:4px 8px; border-radius:6px; font-size:11px;">Chart.js</span>
                    </div>
                </div>

            </div>

            <!-- Footer -->
            <div style="padding:20px; text-align:center;">
                <button class="btn" style="width:100%; box-shadow:0 0 20px rgba(167, 139, 250, 0.3);"
                    onclick="qs('#creditsModal').classList.remove('active')">Chiudi</button>
                <div style="margin-top:15px; font-size:10px; color:rgba(255,255,255,0.2);">
                    Fatto con ‚ù§Ô∏è in Italia
                </div>
            </div>
        </div>
    </div>
    <!-- EXIT MODAL -->
    <!-- EXIT MODAL -->
    <div class="modal" id="exitModal">
        <div class="modal-content-premium" style="max-width:380px;">
            <div class="modal-header-premium">
                <div style="font-size:60px; line-height:1; margin-bottom:10px;"><span data-emoji="warning">‚ö†Ô∏è</span>
                </div>
                <h2 class="premium-title" style="color:#EF4444; background:none; -webkit-text-fill-color: #EF4444;">Esci
                    dalla partita?</h2>
                <div style="font-size:13px; color:rgba(255,255,255,0.5);">Perderai tutti i progressi</div>
            </div>

            <div class="modal-body-premium" style="text-align:center;">
                <p style="color:rgba(255,255,255,0.8); line-height:1.6;">Sei sicuro di voler abbandonare?<br>Se sei
                    l'host, la stanza verr√† chiusa per tutti.</p>
            </div>

            <div style="padding:20px; display:flex; gap:10px;">
                <button class="btn btn-secondary" onclick="qs('#exitModal').classList.remove('active')"
                    style="flex:1;">Resta</button>
                <button class="btn" onclick="window.location.hash=''; window.location.reload();"
                    style="flex:1; background:linear-gradient(135deg, #EF4444, #b91c1c); box-shadow:0 4px 15px rgba(239, 68, 68, 0.4);">S√¨,
                    Esci</button>
            </div>
        </div>
    </div>
    <!-- External Libraries (CDN) -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- Game Logic -->
    <script src="js/core.js"></script>
    <script src="js/data/assets.js"></script>
    <script src="js/data/sounds.js"></script>
    <script src="js/data/bots.js"></script>
    <script src="emoji-manager.js"></script>
</body>

</html>
